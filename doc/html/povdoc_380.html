<!------------------------------------------------------------------------------->
<!--              Generated by makedocs.pl version 1.0 rev 20                  -->
<!--              This file Copyright (c) POV-Team 1991-2002                   -->
<!-- You can override our stylesheet settings by placing a 'povray35.css' file -->
<!--    in the root directory of the disk volume that holds this help file.    -->
<!------------------------------------------------------------------------------->
<html>
<head>
<title>What causes the problem?</title>
<link rel="stylesheet" type="text/css" href="../povray35.css">
<link rel="stylesheet" type="text/css" href="file:///povray35.css">
<object id=htmlhelp type="application/x-oleobject" classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11"></object>
<script language=javascript src="../povray35.js"></script>
</head>
<a name="target_1702"></a>
<body>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_379.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_381.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
<div class="divh3">
<h3>9.8.2&nbsp;&nbsp;What causes the problem?</h3>

<p>Let's start with the sphere with the perturbed normal, since it's easier
to explain.

  
<center><img src="images/vfaq/shadowtest.jpg" alt="Shadow line test with modified normals"><br><font size=-1><cite>Shadow line test with modified normals</cite></font></center>

<p>This image shows graphically what happens.

</p><p>The problem happens in the &quot;dark side&quot; of the object, that is, the side
which doesn't &quot;see&quot; the light source.

</p><p>Although the surface normal points away from the light source (ie. its angle
is &gt;90 degrees from the light source), the perturbed normal points towards
it (ie. its angle is &lt;90 degrees) and thus, according to the normal
vector, the light source should illuminate the point in question.

</p><p>However, when doing the shadow-ray test, POV-Ray sees that the test ray
intersects with a surface (in this case the surface of the same sphere, but
at the &quot;other side&quot;). Thus it decides that the surface in question is
shadowing the current point and thus the light source does not illuminate it.

</p><p>This is what causes the straight shadow exactly where the (non-perturbed)
surface normal is exactly at 90 degrees from the light source.

<br>


</p><p>The problem with the mesh of smooth triangles is a bit more difficult,
although very similar (and caused by the exact same problem).

  
<center><img src="images/vfaq/shadowtest2.jpg" alt="Shadow test of a triangle mesh"><br><font size=-1><cite>Shadow test of a triangle mesh</cite></font></center>

<p>This image shows graphically what happens.

</p><p>Although there's no explicit normal perturbation, the fact that the surface
is a mesh of smooth triangles means that there's an implicit normal
perturbation.

</p><p>In order to get a smooth appearance, each vertex has a normal vector and
the normal vector at any point in the surface of the triangle is calculated
by interpolating the normal vectors of the vertices.

</p><p>Here the problem happens when the shadow line should pass across a triangle
and the unperturbed normal vector of that triangle points away from the
light source. As seen in the figure, a triangle that is closer to the
light source will shadow the point in the current triangle (it's not
necessarily the adjacent triangle, but if the mesh is closed, some triangle
will surely shadow the point in question).

</p><p>This means that this unfortunate triangle will be completely shadowed,
thus causing a triangular artifact in the shadow line of the mesh.

<br>
  
<center><img src="images/vfaq/pic3.gif" alt="The shadow line corresponds to the non-smooth mesh"><br><font size=-1><cite>The shadow line corresponds to the non-smooth mesh</cite></font></center>

<p>The image on the left shows more clearly why the shadow line of the smooth
triangle mesh is like it appeared in the first image of this page.

</p><p>The object at the left is the same triangle mesh, but with flat triangles,
and the object at the right is the same object as in the image at the
beginning of this page.

</p><p>Notice how the shadowed triangles of the flat mesh correspond exactly
to the artifacts in the shadow line of the smooth mesh. The reason for
this was explained in the figure above.

<br>
</p>

</div>

<p>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_379.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_381.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
</body>
</html>
