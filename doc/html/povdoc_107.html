<!------------------------------------------------------------------------------->
<!--              Generated by makedocs.pl version 1.0 rev 20                  -->
<!--              This file Copyright (c) POV-Team 1991-2002                   -->
<!-- You can override our stylesheet settings by placing a 'povray35.css' file -->
<!--    in the root directory of the disk volume that holds this help file.    -->
<!------------------------------------------------------------------------------->
<html>
<head>
<title>Working With Layered Textures</title>
<link rel="stylesheet" type="text/css" href="../povray35.css">
<link rel="stylesheet" type="text/css" href="file:///povray35.css">
<object id=htmlhelp type="application/x-oleobject" classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11"></object>
<script language=javascript src="../povray35.js"></script>
</head>
<a name="target_214"></a>
<body>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_106.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_108.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
<div class="divh3">
<h3>3.9.10&nbsp;&nbsp;Working With Layered Textures</h3>

  <p>With the multitudinous colors, patterns, and options for creating complex
  textures in POV-Ray, we can easily become deeply engrossed in mixing and
  tweaking just the right textures to apply to our latest creations. But as we
  go, sooner or later there is going to come that <em>special</em> texture.
  That texture that is sort of like wood, only varnished, and with a kind of
  spotty yellow streaking, and some vertical gray flecks, that looks like
  someone started painting over it all, and then stopped, leaving part of the
  wood visible through the paint.</p><p>
   Only... now what? How do we get all that into one texture? No pattern can do
  that many things. Before we panic and say image map there is at least one
  more option: <em>layered textures</em>.</p><p>
   With layered textures, we only need to specify a series of textures, one
  after the other, all associated with the same object. Each texture we list
  will be applied one on top of the other, from bottom to top in the order they
  appear.</p><p>
   It is very important to note that we must have some degree of transparency
  (filter or transmit) in the pigments of our upper textures, or the ones below
  will get lost underneath. We won't receive a warning or an error -
  technically it is legal to do this: it just doesn't make sense. It is
  like spending hours sketching an elaborate image on a bare wall, then
  slapping a solid white coat of latex paint over it.</p><p>
   Let's design a very simple object with a layered texture, and look at
  how it works. We create a file called <code>LAYTEX.POV</code> and add the
  following lines.</p>
<pre>
  #include &quot;colors.inc&quot;
  #include &quot;textures.inc&quot;
  camera {
    location &lt;0, 5, -30&gt;
    look_at &lt;0, 0, 0&gt;
  }
  light_source { &lt;-20, 30, -50&gt; color White }
  plane { y, 0 pigment { checker color Green color Yellow  } }
  background { rgb &lt;.7, .7, 1&gt; }
  box {
    &lt;-10, 0, -10&gt;, &lt;10, 10, 10&gt;
    texture {
      Silver_Metal // a metal object ...
      normal {     // ... which has suffered a beating
        dents 2
        scale 1.5
      }
    } // (end of base texture)
    texture { // ... has some flecks of rust ...
      pigment {
        granite
        color_map {
          [0.0 rgb &lt;.2, 0, 0&gt; ]
          [0.2 color Brown ]
          [0.2 rgbt &lt;1, 1, 1, 1&gt; ]
          [1.0 rgbt &lt;1, 1, 1, 1&gt; ]
        }
        frequency 16
      }
    } // (end rust fleck texture)
    texture { // ... and some sooty black marks
      pigment {
        bozo
        color_map {
          [0.0 color Black ]
          [0.2 color rgbt &lt;0, 0, 0, .5&gt; ]
          [0.4 color rgbt &lt;.5, .5, .5, .5&gt; ]
          [0.5 color rgbt &lt;1, 1, 1, 1&gt; ]
          [1.0 color rgbt &lt;1, 1, 1, 1&gt; ]
        }
        scale 3
      }
    } // (end of sooty mark texture)
  } // (end of box declaration)
</pre>

  <p>Whew. This gets complicated, so to make it easier to read, we have
  included comments showing what we are doing and where various parts of the
  declaration end (so we don't get lost in all those closing brackets!). To
  begin, we created a simple box over the classic checkerboard floor, and give
  the background sky a pale blue color. Now for the fun part...</p><p>
   To begin with we made the box use the <code>Silver_Metal</code> texture as
  declared in textures.inc (for bonus points, look up <code>textures.inc</code>
  and see how this standard texture was originally created sometime). To give
  it the start of its abused state, we added the dents normal pattern, which
  creates the illusion of some denting in the surface as if our mysterious
  metal box had been knocked around quite a bit.</p><p>
   The flecks of rust are nothing but a fine grain granite pattern fading from
  dark red to brown which then abruptly drops to fully transparent for the
  majority of the color map. True, we could probably come up with a more
  realistic pattern of rust using pigment maps to cluster rusty spots, but
  pigment maps are a subject for another tutorial section, so let's skip
  that just now.</p><p>
   Lastly, we have added a third texture to the pot. The randomly shifting
  <code>bozo</code> texture gradually fades from blackened centers to
  semi-transparent medium gray, and then ultimately to fully transparent for
  the latter half of its color map. This gives us a look of sooty burn marks
  further marring the surface of the metal box. The final result leaves our
  mysterious metal box looking truly abused, using multiple texture patterns,
  one on top of the other, to produce an effect that no single pattern could
  generate!</p>

</div>

<div class="divh4">
<a name="target_215"></a>
<h4>3.9.10.1&nbsp;&nbsp;Declaring Layered Textures</h4>

  <p>In the event we want to reuse a layered texture on several objects in our
  scene, it is perfectly legal to declare a layered texture. We won't
  repeat the whole texture from above, but the general format would be
  something like this:</p>
<pre>
  #declare Abused_Metal =
    texture { /* insert your base texture here... */ }
    texture { /* and your rust flecks here... */ }
    texture { /* and of course, your sooty burn marks here */ }
</pre>

  <p>POV-Ray has no problem spotting where the declaration ends, because the
  textures follow one after the other with no objects or directives in between.
  The layered texture to be declared will be assumed to continue until it finds
  something other than another texture, so any number of layers can be added in
  to a declaration in this fashion.</p><p>
   One final word about layered textures: whatever layered texture we create,
  whether declared or not, we must not leave off the texture wrapper. In
  conventional single textures a common shorthand is to have just a pigment, or
  just a pigment and finish, or just a normal, or whatever, and leave them
  outside of a texture statement. This shorthand does not extend to layered
  textures. As far as POV-Ray is concerned we can layer entire textures, but
  not individual pieces of textures. For example</p>
<pre>
  #declare Bad_Texture =
    texture { /* insert your base texture here... */ }
    pigment { Red filter .5 }
    normal { bumps 1 }
</pre>

  <p>will not work. The pigment and the normal are just floating there without
  being part of any particular texture. Inside an object, with just a single
  texture, we can do this sort of thing, but with layered textures, we would
  just generate an error whether inside the object or in a declaration.</p>

</div>

<div class="divh4">
<a name="target_216"></a>
<h4>3.9.10.2&nbsp;&nbsp;Another Layered Textures Example</h4>

  <p>To further explain how layered textures work another example is described
  in detail. A tablecloth is created to be used in a picnic scene. Since a
  simple red and white checkered cloth looks entirely too new, too flat, and
  too much like a tiled floor, layered textures are used to stain the
  cloth.</p><p>
   We're going to create a scene containing four boxes. The first box has
  that plain red and white texture we started with in our picnic scene, the
  second adds a layer meant to realistically fade the cloth, the third adds
  some wine stains, and the final box adds a few wrinkles (not another layer,
  but we must note when and where adding changes to the surface normal have an
  effect in layered textures).</p><p>
   We start by placing a camera, some lights, and the first box. At this stage,
  the texture is plain tiling, not layered. See file <code>
  layered1.pov</code>.</p>
<pre>
  #include &quot;colors.inc&quot;
  camera {
    location &lt;0, 0, -6&gt;
    look_at &lt;0, 0, 0&gt;
  }
  light_source { &lt;-20, 30, -100&gt; color White }
  light_source { &lt;10, 30, -10&gt; color White }
  light_source { &lt;0, 30, 10&gt; color White }
  #declare PLAIN_TEXTURE =
    // red/white check
    texture {
      pigment {
        checker
        color rgb&lt;1.000, 0.000, 0.000&gt;
        color rgb&lt;1.000, 1.000, 1.000&gt;
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
  // plain red/white check box
  box {
    &lt;-1, -1, -1&gt;, &lt;1, 1, 1&gt;
    texture {
      PLAIN_TEXTURE
    }
    translate  &lt;-1.5, 1.2, 0&gt;
  }
</pre>

  <p>We render this scene. It is not particularly interesting, is it?
  That is why we will use some layered textures to make it more
  interesting.</p><p>
   First, we add a layer of two different, partially transparent grays. We tile
  them as we had tiled the red and white colors, but we add some turbulence to
  make the fading more realistic. We add following box to the previous scene
  and re-render (see file <code>layered2.pov</code>).</p>
<pre>
  #declare FADED_TEXTURE =
    // red/white check texture
    texture {
      pigment {
        checker
        color rgb&lt;0.920, 0.000, 0.000&gt;
        color rgb&lt;1.000, 1.000, 1.000&gt;
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
    // greys to fade red/white
    texture {
      pigment {
        checker
        color rgbf&lt;0.632, 0.612, 0.688, 0.698&gt;
        color rgbf&lt;0.420, 0.459, 0.520, 0.953&gt;
        turbulence 0.500
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
  // faded red/white check box
  box {
    &lt;-1, -1, -1&gt;, &lt;1, 1, 1&gt;
    texture {
      FADED_TEXTURE
    }
    translate  &lt;1.5, 1.2, 0&gt;
  }
</pre>

  <p>Even though it is a subtle difference, the red and white checks no longer
  look quite so new.</p><p>
   Since there is a bottle of wine in the picnic scene, we thought it might be
  a nice touch to add a stain or two. While this effect can almost be achieved
  by placing a flattened blob on the cloth, what we really end up with is a
  spill effect, not a stain. Thus it is time to add another layer.</p><p>
   Again, we add another box to the scene we already have scripted and
  re-render (see file <code>layered3.pov</code>).</p>
<pre>
  #declare STAINED_TEXTURE =
    // red/white check
    texture {
      pigment {
        checker
        color rgb&lt;0.920, 0.000, 0.000&gt;
        color rgb&lt;1.000, 1.000, 1.000&gt;
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
    // greys to fade check
    texture {
      pigment {
        checker
        color rgbf&lt;0.634, 0.612, 0.688, 0.698&gt;
        color rgbf&lt;0.421, 0.463, 0.518, 0.953&gt;
        turbulence 0.500
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
    // wine stain
    texture {
      pigment {
        spotted
        color_map {
          [ 0.000  color rgb&lt;0.483, 0.165, 0.165&gt; ]
          [ 0.329  color rgbf&lt;1.000, 1.000, 1.000, 1.000&gt; ]
          [ 0.734  color rgbf&lt;1.000, 1.000, 1.000, 1.000&gt; ]
          [ 1.000  color rgb&lt;0.483, 0.165, 0.165&gt; ]
        }
        turbulence 0.500
        frequency 1.500
      }
    }
  // stained box
  box {
    &lt;-1, -1, -1&gt;, &lt;1, 1, 1&gt;
    texture {
      STAINED_TEXTURE
    }
    translate  &lt;-1.5, -1.2, 0&gt;
  }
</pre>

  <p>Now there's a tablecloth texture with personality.</p><p>
   Another touch we want to add to the cloth are some wrinkles as if the cloth
  had been rumpled. This is not another texture layer, but when working with
  layered textures, we must keep in mind that changes to the surface normal
  must be included in the uppermost layer of the texture. Changes to lower
  layers have no effect on the final product (no matter how transparent the
  upper layers are).</p><p>
   We add this final box to the script and re-render (see file <code>
  layered4.pov</code>)</p>
<pre>
  #declare WRINKLED_TEXTURE =
    // red and white check
    texture {
      pigment {
        checker
        color rgb&lt;0.920, 0.000, 0.000&gt;
        color rgb&lt;1.000, 1.000, 1.000&gt;
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
    // greys to &quot;fade&quot; checks
    texture {
      pigment {
        checker
        color rgbf&lt;0.632, 0.612, 0.688, 0.698&gt;
        color rgbf&lt;0.420, 0.459, 0.520, 0.953&gt;
        turbulence 0.500
        scale &lt;0.2500, 0.2500, 0.2500&gt;
      }
    }
    // the wine stains
    texture {
      pigment {
        spotted
        color_map {
          [ 0.000  color rgb&lt;0.483, 0.165, 0.165&gt; ]
          [ 0.329  color rgbf&lt;1.000, 1.000, 1.000, 1.000&gt; ]
          [ 0.734  color rgbf&lt;1.000, 1.000, 1.000, 1.000&gt; ]
          [ 1.000  color rgb&lt;0.483, 0.165, 0.165&gt; ]
        }
        turbulence 0.500
        frequency 1.500
      }
      normal {
        wrinkles 5.0000
      }
    }
  // wrinkled box
  box {
    &lt;-1, -1, -1&gt;, &lt;1, 1, 1&gt;
    texture {
      WRINKLED_TEXTURE
    }
    translate  &lt;1.5, -1.2, 0&gt;
  }
</pre>

  <p>Well, this may not be the tablecloth we want at any picnic we're
  attending, but if we compare the final box to the first, we see just how much
  depth, dimension, and personality is possible just by the use of creative
  texturing.</p><p>
   One final note: the comments concerning the surface normal do not hold true
  for finishes. If a <em>lower</em> layer contains a specular finish and an
  <em>upper</em> layer does not, any place where the upper layer is
  transparent, the specular will show through.</p>

</div>

<p>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_106.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_108.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
</body>
</html>
