<!------------------------------------------------------------------------------->
<!--              Generated by makedocs.pl version 1.0 rev 20                  -->
<!--              This file Copyright (c) POV-Team 1991-2002                   -->
<!-- You can override our stylesheet settings by placing a 'povray35.css' file -->
<!--    in the root directory of the disk volume that holds this help file.    -->
<!------------------------------------------------------------------------------->
<html>
<head>
<title>Using Photon Mapping in Your Scene</title>
<link rel="stylesheet" type="text/css" href="../povray35.css">
<link rel="stylesheet" type="text/css" href="file:///povray35.css">
<object id=htmlhelp type="application/x-oleobject" classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11"></object>
<script language=javascript src="../povray35.js"></script>
</head>
<a name="target_1236"></a>
<body>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_229.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_231.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
<div class="divh3">
<h3>6.10.2&nbsp;&nbsp;Using Photon Mapping in Your Scene</h3>

<p>When designing a scene with photons, it helps to think of the scene objects
in two categories.  Objects in the first category will show photon caustics
when hit by photons.  Objects in the second category cause photon caustics
by reflecting or refracting photons.  Some objects may be in both
categories, and some objects may be in neither category.</p>

<p>Category 1 - Objects that show photon caustics</p>

<p>By default, all objects are in the first category.  Whenever a photon hits
an object, the photon is stored and will later be used to render caustics on
that object.  This means that, by default, caustics from photons can appear
on any surface.  To speed up rendering, you can take objects out of this
category.  You do this with the line: <code>photons{collect off}</code>.  If you use
this syntax, caustics from photons will not appear on the object.  This will
save both memory and computational time during rendering.</p>

<p>Category 2 - Objects that cause photon caustics</p>

<p>By default, there are no objects in the second category.  If you want your
object to cause caustics, you need to do two things.  First, make your object into
a &quot;target.&quot;  You do this with the <code>target</code> keyword.  This enables light
sources to shoot photons at your object.  Second, you need to specify if
your object reflects photons, refracts photons, or both.  This is done with
the <code>reflection on</code> and <code>refraction on</code> keywords.  To allow an object to
reflect and refract photons, you would use the following lines of code
inside the object:
</p>
<pre>
photons{
  target
  reflection on
  refraction on
}
</pre>


<p>Generally speaking, you don't want an object to be in both categories.  Most
objects that cause photon caustics do not themselves have much color or
brightness.  Usually they simply refract or reflect their surroundings.  For
this reason, it is usually a waste of time to display photon caustics on
such surfaces.  Even if computed, the effects from the caustics would be so
dim that they would go unnoticed.</p>

<p>Sometimes, you may also wish to add <code>photons{collect off}</code> to other clear or
reflective objects, even if they are not photon targets.  Again, this is
done to prevent unnecessary computation of caustic lighting.</p>

<p>Finally, you may wish to enable photon reflection and refraction for a
surface, even if it is not a target.  This allows indirect photons (photons
that have already hit a target and been reflected or refracted) to continue
their journey after hitting this object.</p>

</div>

<div class="divh4">
<a name="target_1237"></a>
<h4>6.10.2.1&nbsp;&nbsp;Photon Global Settings</h4>

<pre>global_photon_block:
photons {
  spacing &lt;photon_spacing&gt; | count &lt;photons_to_shoot&gt;

  [gather &lt;min_gather&gt;, &lt;max_gather&gt;]
  [media &lt;max_steps&gt; [,&lt;factor&gt;]]
  [jitter &lt;jitter_amount&gt;]
  [max_trace_level &lt;photon_trace_level&gt;]
  [adc_bailout &lt;photon_adc_bailout&gt;]
  [save_file &quot;filename&quot; | load_file &quot;filename&quot;]
  [autostop &lt;autostop_fraction&gt;]
  [expand_thresholds &lt;percent_increase&gt;, &lt;expand_min&gt;]
  [radius &lt;gather_radius&gt;,&lt;multiplier&gt;,
          &lt;gather_radius_media&gt;,&lt;multiplier&gt;]
}</pre>

<p>
All photons default values:
<a name="target_1238"></a>
<pre>
Global :
  expand_min    : 40 
  gather        : 20, 100
  jitter        : 0.4
  media         : 0

Object :
  collect       : on
  refraction    : off
  reflection    : off
  split_union   : on
  target        : 1.0

Light_source:
  area_light    : off
  refraction    : off
  reflection    : off

</pre>
</p>

<p>To specify photon gathering and storage options you need to add a photons
block to the global_settings section of your scene.</p>

<p>For example:</p>

<pre>
 global_settings {
   photons {
     count 20000
     autostop 0
     jitter .4
   }
 }
</pre>

<p>The number of photons generated can be set using either the spacing or count
keywords: </p>

<a name="target_1239"></a>
<ul>
  <li>If spacing is used, it specifies approximately the average distance
  between photons on surfaces. If you cut the spacing in half, you will get four
  times as many surface photons, and eight times as many media photons.</li>
  <li>If count is used, POV-Ray will shoot the approximately number of photons
  specified. The actual number of photons that result from this will almost
  always be at least slightly different from the number specified. Still, if you
  double the photons_to_shoot value, then twice as many photons will be shot. If
  you cut the value in half, then half the number of photons will be shot.
    <ul>
      <li>It may be less, because POV shoots photons at a target object's
      bounding box, which means that some photons will miss the target object.</li>
      <li>On the other hand, may be more, because each time one object hits an
      object that has both reflection and refraction, two photons are created
      (one for reflection and one for refraction).</li>
      <li>POV will attempt to compensate for these two factors, but it can only
      estimate how many photons will actually be generated. Sometimes this
      estimation is rather poor, but the feature is still usable.</li>
    </ul></li>
</ul>

<a name="target_1240"></a>

<p>The keyword <code>gather</code> allows you to specify how many photons are
gathered at each point during the regular rendering step. The first number
(default 20) is the minimum number to gather, while the second number (default
100) is the maximum number to gather. These are good values and you should only
use different ones if you know what you&#146;re doing.</p>

<a name="target_1241"></a>

<a name="target_1242"></a>

<p>The keyword <code>media</code> turns on media photons. The parameter 
<code>max_steps</code> specifies the maximum number of photons to deposit 
over an interval. The optional parameter factor specifies the difference in 
media spacing compared to surface spacing. You can increase factor and 
decrease max_steps if too many photons are being deposited in media.</p>

<a name="target_1243"></a>
<p>The keyword <code>jitter</code> specifies the amount of jitter used in the
sampling of light rays in the pre-processing step. The default value is good and
usually does not need to be changed.</p>

<a name="target_1244"></a>
<a name="target_1245"></a>
<p>The keywords <code>max_trace_level</code> and <code>adc_bailout</code> allow
you to specify these attributes for the photon-tracing step. If you do not
specify these, the values for the primary ray-tracing step will be used.</p>

<a name="target_1246"></a>

<a name="target_1247"></a>

<p>The keywords <code>save_file</code> and <code>load_file</code> allow you to
save and load photon maps. If you load a photon map, no photons will be shot.
The photon map file contains all surface (caustic) and media
photons.</p>

<a name="target_1248"></a>

<p><code>radius</code> is used for gathering photons. The larger the radius, the longer it
takes to gather photons. But if you use too small of a radius, you might
not get enough photons to get a good estimate. Therefore, choosing a good
radius is important. Normally POV-Ray looks through the photon map and uses some ad-hoc statistical analysis to determine a reasonable radius. Sometimes it does a good job, sometimes it does not. The radius keyword lets you override or adjust POV-Ray's guess.
</p>
<p><code>radius</code> parameters (all are optional):
<ol>
  <li>Manually set the gather radius for surface photons.  If this is either
  zero or if you leave it out, POV-Ray will analyze and guess.</li>
  <li>Adjust the radius for surface photons by setting a multiplier.  If POV-Ray, for example, is picking a radius that you think is too big (render is too slow), you can use &quot;<code>radius ,0.5</code>&quot; to lower the radius (multiply by 0.5) and speed up the render at the cost of quality.</li>
  <li>Manually set the gather radius for media photons.</li>
  <li>Adjust the radius for media photons by setting a multiplier.
</ol>
</p>

<p>The keywords <code><a href="povdoc_233.html#target_1259">autostop</a></code>
and <code><a href="povdoc_233.html#target_1261">expand_thresholds</a></code> will be explained later.</p>

</div>

<div class="divh4">
<a name="target_1249"></a>
<h4>6.10.2.2&nbsp;&nbsp;Shooting Photons at an Object</h4>

<pre>
object_photon_block:
photons {
  [target [&lt;spacing_multiplier&gt;]]
  [refraction on|off]
  [reflection on|off]
  [collect on|off]
  [pass_through]
}
</pre>

<p>To shoot photons at an object, you need to tell POV that the object receives
photons. To do this, create a <code>photons { }</code> block within the object. For example:</p>

<pre>
 object {
   MyObject
   photons {
     target
     refraction on
     reflection on
     collect off
   }
 }
</pre>

<p>In this example, the object both reflects and refracts photons. Either of
these options could be turned off (by specifying reflection off, for example).
By using this, you can have an object with a reflective finish which does not
reflect photons for speed and memory reasons.</p>

<a name="target_1250"></a>

<p>The keyword <code>target</code> makes this object a target.</p>

<a name="target_1251"></a>

<p>The density of the photons can be adjusted by specifying the 
<code>spacing_multiplier</code>. If, for example, you specify a 
<code>spacing_multiplier</code> of 0.5, then the spacing for photons hitting 
this object will be 1/2 of the distance of the spacing for other objects.</p>

<p class="Note"><strong>Note:</strong> This means four times as many surface photons, and
eight times as many media photons.</p>

<a name="target_1252"></a>

<p>The keyword <code>collect off</code> causes the object to ignore photons.
Photons are neither deposited nor gathered on that object.</p>

<a name="target_1253"></a>

<p>The keyword <code>pass_through</code> causes photons to pass through the 
object <strong>unaffected</strong> on their way to a target object. Once a 
photon hits the target object, it will ignore the <code>pass_through</code> 
flag. This is basically a photon version of the <code>no_shadow</code> 
keyword, with the exception that media within the object will still be 
affected by the photons (unless that media specifies collect off). If you 
use the <code>no_shadow</code> keyword, the object will be tagged as 
<code>pass_through</code> automatically. You can then turn off 
<code>pass_through</code> if necessary by simply using <code>photons { 
pass_through off }</code>.</p>

<p class="Note"><strong>Note:</strong> Photons will not be shot at an object unless you
specify the <code>target</code> keyword. Simply turning refraction on will not
suffice.</p>

<p>When shooting photons at a CSG-union, it may sometimes be of advantage to use
<code><a href="povdoc_192.html#target_910">split_union off</a></code> inside the union. 
POV-Ray will be forced to shoot at the whole object, instead of splitting it up
and shooting photons at its compound parts.</p>

</div>

<div class="divh4">
<a name="target_1254"></a>
<h4>6.10.2.3&nbsp;&nbsp;Photons and Light Sources</h4>

<pre>
 light_photon_block:
 photons {
   [refraction on | off]
   [reflection on | off]
   [area_light]
 }
</pre>
<p>Example:</p>
<pre>
 light_source {
   MyLight
   photons {
     refraction on
     reflection on
   }
 }
</pre>

<p>Sometimes, you want photons to be shot from one light source and not another.
In that case, you can turn photons on for an object, but specify <code>photons {
reflection off refraction off }</code> in the light source&#146;s definition.
You can also turn off only reflection or only refraction for any light
source.</p>

</div>

<div class="divh4">
<a name="target_1255"></a>
<h4>6.10.2.4&nbsp;&nbsp;Photons and Media</h4>

<pre>
 global_settings {
   photons {
     count 10000
     media 100
   }
 }
</pre>

<p>Photons also interact fully with media. This means that volumetric photons
are stored in scattering media. This is enabled by using the keyword media
within the photons block.</p>

<p>To store photons in media, POV deposits photons as it steps through the media
during the photon-tracing phase of the render. It will deposit these photons as
it traces caustic photons, so the number of media photons is dependant on the
number of caustic photons. As a light ray passes through a section of media, the
photons are deposited, separated by approximately the same distance that
separates surface photons.</p>

<p>You can specify a factor as a second optional parameter to the media keyword.
If, for example, factor is set to 2.0, then photons will be spaced twice as far
apart as they would otherwise have been spaced.</p>

<p>Sometimes, however, if a section of media is very large, using these settings
could create a large number of photons very fast and overload memory. Therefore,
following the media keyword, you must specify the maximum number of photons that
are deposited for each ray that travels through each section of media. A setting
of 100 should probably work in most cases.</p>

<p>You can put <code>collect off</code> into media to make that media ignore
photons. Photons will neither be deposited nor gathered in a media that is
ignoring them. Photons will also not be gathered nor deposited in non-scattering
media. However, if multiple medias exist in the same space, and at least
one does not ignore photons and is scattering, then photons will be deposited in
that interval and will be gathered for use with all media in that interval.</p>

</div>

<p>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_229.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_231.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
</body>
</html>
