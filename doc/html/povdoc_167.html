<!------------------------------------------------------------------------------->
<!--              Generated by makedocs.pl version 1.0 rev 20                  -->
<!--              This file Copyright (c) POV-Team 1991-2002                   -->
<!-- You can override our stylesheet settings by placing a 'povray35.css' file -->
<!--    in the root directory of the disk volume that holds this help file.    -->
<!------------------------------------------------------------------------------->
<html>
<head>
<title>The #declare and #local Directives</title>
<link rel="stylesheet" type="text/css" href="../povray35.css">
<link rel="stylesheet" type="text/css" href="file:///povray35.css">
<object id=htmlhelp type="application/x-oleobject" classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11"></object>
<script language=javascript src="../povray35.js"></script>
</head>
<a name="target_659"></a>
<body>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_166.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_168.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
<div class="divh3">
<h3>6.2.2&nbsp;&nbsp;The #declare and #local Directives</h3>

<a name="target_660"></a>

  <p>Identifiers may be declared and later referenced to make scene files more
  readable and to parameterize scenes so that changing a single declaration
  changes many values. There are several built-in identifiers which POV-Ray
  declares for you. See section &quot;<a href="povdoc_158.html#target_535">Built-in Float Identifiers</a>&quot; and
  &quot;<a href="povdoc_159.html#target_602">Built-in Vector Identifiers</a>&quot; for details.</p>

</div>

<div class="divh4">
<a name="target_661"></a>
<h4>6.2.2.1&nbsp;&nbsp;Declaring identifiers</h4>

<a name="target_662"></a>

  <p>An identifier is declared as follows.</p>
<pre>
DECLARATION:
    #declare IDENTIFIER = RVALUE |
    #local IDENTIFIER = RVALUE
RVALUE:
    FLOAT; | VECTOR; | COLOR; | STRING | OBJECT | TEXTURE |
    PIGMENT | NORMAL | FINISH | INTERIOR | MEDIA | DENSITY |
    COLOR_MAP | PIGMENT_MAP | SLOPE_MAP | NORMAL_MAP |
    DENSITY_MAP | CAMERA | LIGHT_SOURCE | FOG | RAINBOW |
    SKY_SPHERE | TRANSFORM
</pre>

  <p>Where <em>IDENTIFIER</em> is the name of the identifier up to 40
  characters long and <em>RVALUE</em> is any of the listed items. They are
  called that because they are values that can appear to the <em>right</em> of
  the equals sign. The syntax for each is in the corresponding section of this
  language reference. Here are some examples.</p>
<pre>
 #declare Rows = 5;
 #declare Count = Count+1;
 #local  Here = &lt;1,2,3&gt;;
 #declare White = rgb &lt;1,1,1&gt;;
 #declare Cyan = color blue 1.0 green 1.0;
 #declare Font_Name = &quot;ariel.ttf&quot;
 #declare Rod = cylinder {-5*x,5*x,1}
 #declare Ring = torus {5,1}
 #local  Checks = pigment { checker White, Cyan }
 object{ Rod scale y*5 }     // not &quot;cylinder { Rod }&quot;
 object {
  Ring
  pigment { Checks scale 0.5 }
  transform Skew
 }
</pre>

  <p class="Note"><strong>Note:</strong> that there should be a semi-colon after the expression in all float,
  vector and color identifier declarations. This semi-colon is introduced in POV-Ray
  version 3.1. If omitted, it generates a warning and some macros may not work
  properly. Semicolons after other declarations are optional.</p><p>
   Declarations, like most language directives, can appear almost anywhere in the file
  - even within other statements. For example:</p>
<pre>
 #declare Here=&lt;1,2,3&gt;;
 #declare Count=0;         // initialize Count
 union {
  object { Rod translate Here*Count }
  #declare Count=Count+1;     // re-declare inside union
  object { Rod translate Here*Count }
  #declare Count=Count+1;     // re-declare inside union
  object { Rod translate Here*Count }
 }
</pre>

  <p>As this example shows, you can re-declare an identifier and may use
  previously declared values in that re-declaration.</p>
  <p class="Note"><strong>Note:</strong> object identifiers use the generic wrapper statement <code>
  object{</code> ... <code>}</code>. You do not need to know what kind of
  object it is.</p><p>
   Declarations may be nested inside each other within limits. In the example
  in the previous section you could declare the entire union as a object.
  However for technical reasons there are instances where you may not use any
  language directive inside the declaration of floats, vectors or color
  expressions. Although these limits have been loosened somewhat since POV-Ray
  3.1, they still exist.</p><p>
   Identifiers declared within <code><a href="povdoc_173.html#target_694">#macro</a></code> ...
  <code><a href="povdoc_171.html#target_682">#end</a></code> blocks are not created at the 
  time the macro is defined. They are only created at the time the macro is 
  actually invoked. Like all other items inside such a #macro definition, 
  they are ignored when the macro is defined.</p>

</div>

<div class="divh4">
<a name="target_663"></a>
<h4>6.2.2.2&nbsp;&nbsp;#declare vs. #local</h4>

  <p>Identifiers may be declared either global using <code><a href="#target_662">#declare</a></code> or
  local using the <code><a href="#target_660">#local</a></code> directive.</p><p>
  Those created by the <code>#declare</code> directive are permanent in
  duration and global in scope. Once created, they are available throughout the
  scene and they are not released until all parsing is complete or until they
  are specifically released using <code>#undef</code>. See
  &quot;<a href="#target_666">Destroying Identifiers</a>&quot;.</p><p>
   Those created by the <code>#local</code> directive are temporary in duration
  and local in scope. They temporarily override any identifiers with the same
  name. See &quot;<a href="#target_664">Identifier Name Collisions</a>&quot;.</p><p>
  If <code>#local</code> is used inside a <code> #macro</code> then the
  identifier is local to that macro. When the macro is invoked and the
  <code>#local</code> directive is parsed, the identifier is created. It persists
  until the <code>#end</code> directive of the macro is reached. At the <code>#end</code>
  directive, the identifier is destroyed. Subsequent invocations of the macro
  create totally new identifiers.</p><p>
   Use of <code>#local</code> within an include file but not in a macro, also
  creates a temporary identifier that is local to that include file. When the
  include file is included and the <code>#local</code> directive is parsed, the
  identifier is created. It persists until the end of the include file is
  reached. At the end of file the identifier is destroyed. Subsequent inclusions
  of the file create totally new identifiers.</p><p>
   Use of <code>#local</code> in the main scene file (not in an include file
  and not in a macro) is identical to <code>#declare</code>. For clarity sake
  you should not use <code>#local</code> in a main file except in a macro.</p><p>
   There is currently no way to create permanent, yet local identifiers in
  POV-Ray.</p><p>
   Local identifiers may be specifically released early using <code><a href="#target_666">#undef</a></code>
  but in general there is no need to do so. See &quot;<a href="#target_666">Destroying Identifiers</a>&quot;.</p>

</div>

<div class="divh4">
<a name="target_664"></a>
<h4>6.2.2.3&nbsp;&nbsp;Identifier Name Collisions</h4>

  <p>Local identifiers may have the same names as previously declared
  identifiers. In this instance, the most recent, most local identifier takes
  precedence. Upon entering an include file or invoking a macro, a new symbol
  table is created. When referencing identifiers, the most recently created
  symbol table is searched first, then the next most recent and so on back to
  the global table of the main scene file. As each macro or include file is
  exited, its table and identifiers are destroyed. Parameters passed by value
  reside in the same symbol table as the one used for identifiers local to the
  macro.</p><p>
   The rules for duplicate identifiers may seem complicated when multiple-nested
  includes and macros are involved, but in actual practice the results are
  generally what you intended.</p><p>
   Consider this example: You have a main scene file called <code>myscene.pov</code>
  and it contains</p>
<pre>
 #declare A = 123;
 #declare B = rgb&lt;1,2,3&gt;;
 #declare C = 0;
 #include &quot;myinc.inc&quot;
</pre>

  <p>Inside the include file you invoke a macro called <code>MyMacro(J,K,L)</code>.
  It isn't important where <code> MyMacro</code> is defined as long 
  as it is defined before it is invoked. In this example, it is important 
  that the macro is invoked from within <code> myinc.inc</code>.</p><p>
   The identifiers <code>A</code>, <code>B</code>, and <code> C</code> are
  generally available at all levels. If either <code> myinc.inc</code> or
  <code> MyMacro</code> contain a line such as <code> #declare C=C+1;</code>
  then the value <code>C</code> is changed everywhere as you might expect.</p><p>
   Now suppose inside <code>myinc.inc</code> you do...</p>
<pre>
 #local A = 546;
</pre>

  <p>The main version of <code>A</code> is hidden and a new <code>A</code> is
  created. This new <code>A</code> is also available inside <code>
  MyMacro</code> because <code>MyMacro</code> is nested inside <code>
  myinc.inc</code>. Once you exit <code>myinc.inc</code>, the local <code>
  A</code> is destroyed and the original <code>A</code> with its value of
  <code>123</code> is now in effect. Once you have created the local <code>
  A</code> inside <code>myinc.inc</code>, there is no way to reference the
  original global <code>A</code> unless you <code>#undef A</code> or exit the
  include file. Using <code>#undef</code> always undefines the most local
  version of an identifier.</p><p>
   Similarly if <code>MyMacro</code> contained...</p>
<pre>
 #local B = box{0,1}
</pre>

  <p>then a new identifier <code>B</code> is created local to the macro only.
  The original value of <code>B</code> remains hidden but is restored when the
  macro is finished. The local <code>B</code> need not have the same
  type as the original.</p><p>
   The complication comes when trying to assign a new value to an identifier at
  one level that was declared local at an earlier level. Suppose inside <code>
  myinc.inc</code> you do...</p>
<pre>
 #local D = 789;
</pre>

  <p>If you are inside <code>myinc.inc</code> and you want to increment <code>
  D</code> by one, you might try to do...</p>
<pre>
 #local D = D + 1;
</pre>

  <p>but if you try to do that inside <code>MyMacro</code> you'll create a
  new <code>D</code> which is local to <code>MyMacro</code> and not the <code>
  D</code> which is external to <code>MyMacro</code> but local to <code>
  myinc.inc</code>. Therefore you've said &quot;create a <code> MyMacro
  D</code> from the value of <code>myinc.inc</code>'s <code> D</code> plus
  one&quot;. That's probably not what you wanted. Instead you should
  do...</p>
<pre>
 #declare D = D + 1;
</pre>

  <p>You might think this creates a new <code>D</code> that is global but it
  actually increments the myinc.inc version of <code>D</code>. Confusing
  isn't it? Here are the rules:</p>

  <ol>
    <li>When referencing an identifier, you always get the most recent, most
        local version. By &quot;referencing&quot; we mean using the value of the
        identifier in a POV-Ray statement or using it on the right of an equals sign
        in either a <code>#declare</code> or <code> #local</code>.</li>

    <li>When declaring an identifier using the <code>#local</code> keyword,
        the identifier which is created or has a new value assigned, is ALWAYS
        created at the current nesting level of macros or include files.</li>

    <li>When declaring a NEW, NON-EXISTANT identifier using <code>#declare</code>,
        it is created as fully global. It is put in the symbol table of the main
        scene file.</li>

    <li>When ASSIGNING A VALUE TO AN EXISTING identifier using <code>#declare</code>,
        it assigns it to the most recent, most local version at the time.</li>
  </ol>

  <p>In summary, <code>#local</code> always means &quot;the current
  level&quot;, and <code>#declare</code> means &quot;global&quot; for new
  identifiers and &quot;most recent&quot; for existing identifiers.</p>

</div>

<div class="divh4">
<a name="target_665"></a>
<h4>6.2.2.4&nbsp;&nbsp;Destroying Identifiers with #undef</h4>

<a name="target_666"></a>

  <p>Identifiers created with <code>#declare</code> will generally persist
  until parsing is complete. Identifiers created with <code>#local</code> will
  persist until the end of the macro or include file in which they were
  created. You may however un-define an identifier using the <code>
  #undef</code> directive. For example:</p>
<pre>
 #undef MyValue
</pre>

  <p>If multiple local nested versions of the identifier exist, the most local
  most recent version is deleted and any identically named identifiers which
  were created at higher levels will still exist.</p>

  <p>See also <a href="povdoc_171.html#target_684">&quot;The #ifdef and #ifndef Directives&quot;</a>.</p>

</div>

<p>
<center>
<table width=100% border=0>
<tr>
<td>
<table width=100% align="center" border=0 bgcolor="#ffcc99" class="NavBar">
<tr>
<td align="left">&lt;<a href="povdoc_166.html">Prev</a></td>
<script language="JavaScript">
<!--
if (navigator.userAgent.indexOf ("MSIE 3.") >= 1)
  document.write ("<td align=center><small><i>You are running <b>IE3</b>. This will likely cause problems with this help file.</i></small></td>") ;
else if (navigator.userAgent.indexOf ("MSIE 4.") >= 1)
  document.write ("<td align=center><small><i>The Microsoft HTML Help system works best with <b>IE5</b> or later. We recommend you upgrade.</i></small></td>") ;
//-->
</script>
<td align="right"><a href="povdoc_168.html">Next</a>&gt;</td></tr>
</table>
</td>
</tr>
</table>
</center>
</body>
</html>
